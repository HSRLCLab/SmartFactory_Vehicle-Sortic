<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SmartVehicle-Sortic: SmartFactory_Vehicle-Sortic</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SmartVehicle-Sortic
   </div>
   <div id="projectbrief">SmartFactory</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md__v_1__git__smart_factory__vehicle-_sortic__r_e_a_d_m_e.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">SmartFactory_Vehicle-Sortic </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The <a href="https://github.com/LMazzole/SmartFactory_Vehicle-Sortic">SmartFactory_Vehicle-Sortic</a> is an implementation from the <em>SmartFactory</em> project for Sortic.</p>
<p>It's a Smart-Vehicle which can navigate on a known game-table and communicates this information wirelessly to its environment using the <a href="https://github.com/LMazzole/SmartFactory_MQTTCommunication">SmartFactory_MQTTCommunication</a> and the <a href="https://github.com/LMazzole/SmartFactory_Vehicle-Basis">SmartFactory_Vehicle-Basis</a>-component.</p>
<p>Multiple nested Finite State Machines (FSM) based on the pattern of the <a href="https://github.com/LMazzole/ArdFSM">ArdFSM</a> are used to control the processes.</p>
<h2>Table of contents</h2>
<ul>
<li><a href="#the-smartfactory-project---sortic">The SmartFactory project - Sortic</a></li>
<li><a href="#tools-and-technologies">Tools and technologies</a><ul>
<li><a href="#doxygen">Doxygen</a></li>
<li><a href="#vscode-platformio">VSCode PlatformIO</a></li>
<li><a href="#mqtt">MQTT</a></li>
</ul>
</li>
<li><a href="#documentation">Documentation</a><ul>
<li><a href="#hardware">Hardware</a></li>
<li><a href="#gametable">Gametable</a></li>
<li><a href="#software">Software</a><ul>
<li><a href="#dependency-graph">Dependency graph</a></li>
<li><a href="#collaboration-diagram">Collaboration diagram</a></li>
<li><a href="#important-functions-and-files">Important functions and files</a><ul>
<li><a href="#configurationh">Configuration.h</a></li>
</ul>
</li>
<li><a href="#communication">Communication</a><ul>
<li><a href="#handshake-with-box">Handshake with box</a></li>
<li><a href="#transfer-and-vehicle">Transfer and vehicle</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#faqs">FAQ's</a><ul>
<li><a href="#id-like-to-use-this-code-in-my-project-what-do-i-need-to-know">I'd like to use this code in my project. What do I need to know?</a></li>
</ul>
</li>
<li><a href="#todos">ToDo's</a><ul>
<li><a href="#software-1">Software</a></li>
</ul>
</li>
<li><a href="#contributors">Contributors</a></li>
<li><a href="#changelog">Changelog</a></li>
<li><a href="#license">License</a></li>
</ul>
<div style="page-break-after: always;"></div><h2>The SmartFactory project - Sortic</h2>
<p>The implementation of the <em>SmartFactory</em> project for Sortic looks as follows:</p>
<img src="./docs/images/RepoOverview.png" height="300" alt="" class="inline"/>
<p>The associated repositories are:</p>
<p><a href="https://github.com/LMazzole/SmartFactory-Sortic">SmartFactory-Sortic</a></p>
<p><a href="https://github.com/LMazzole/SmartFactory_Box-Sortic">SmartFactory_Box-Sortic</a></p>
<p><a href="https://github.com/LMazzole/SmartFactory_Vehicle-Sortic">SmartFactory_Vehicle-Sortic</a></p>
<p><a href="https://github.com/LMazzole/SmartFactory_Vehicle-Basis">SmartFactory_Vehicle-Basis</a></p>
<p><a href="https://github.com/LMazzole/SmartFactory_MQTTCommunication">SmartFactory_MQTTCommunication</a></p>
<h2>Tools and technologies</h2>
<p>The source code is written in C++. To achieve this project, the following tools and technologies were used.</p>
<h3>Doxygen</h3>
<p>Doxygen is used for the documentation of the source-code.</p>
<p>An intorduction to <em>Doxygen</em> and how to install it can be found in the <a href="https://github.com/LMazzole/ArdFSM#documentation-with-doxygen">ArdFSM-Repo</a>.</p>
<h3>VSCode PlatformIO</h3>
<p>The used IDE is <a href="https://code.visualstudio.com/">VSCode</a> with the <a href="https://platformio.org/platformio-ide">PlatformIO</a>-extension.</p>
<h3>MQTT</h3>
<p>For a description of the MQTT-Technologie take a look at the <a href="https://github.com/LMazzole/SmartFactory_MQTTCommunication#mqtt">MQTTCommunication-ReadMe</a>.</p>
<div style="page-break-after: always;"></div><h1>Documentation</h1>
<h2>Hardware</h2>
<p>For a description of the used hardware take a look at the <a href="https://github.com/LMazzole/SmartFactory_Vehicle-Basis">Vehicle-Basis-ReadMe</a>.</p>
<h2>Gametable</h2>
<p>The <em>Gametable</em> consists of black lines on a white (light) background. It is composed of different sectors:</p>
<ul>
<li>Handover (Sortic/Transfer)</li>
<li>Gateway (Sortic/Transfer)</li>
<li>Waiting area</li>
<li>Transit</li>
<li>(Parking)</li>
</ul>
<p>These sectors are also separate states and can easily be customized in <a href="https://lmazzole.github.io/SmartFactory_Vehicle-Sortic/class_navigation_ctrl.html">NavigationCtrl</a>. </p>
<img src="./lib/Navigation/Gametable.png" height="500" alt="" class="inline"/>
<img src="./docs/images/GametableDimension.png" height="500" alt="" class="inline"/>
<div style="page-break-after: always;"></div><h2>Software</h2>
<p>All functions and files are documented on the <a href="https://lmazzole.github.io/SmartFactory_Vehicle-Sortic/">GitHub-Page with Doxygen</a>.</p>
<p>The documentation does <b>not</b> include the <a href="https://github.com/LMazzole/SmartFactory_MQTTCommunication">MQTTCommunication</a> and the <a href="https://github.com/LMazzole/SmartFactory_Vehicle-Basis">SmartFactory_Vehicle-Basis</a>-files. If you would like the complete documentation with these files included you need to build it yourself with the <em>Doxygen-complete</em> file.</p>
<p>It's important to mention that all functions are non-blocking and as short as possible so no other process starves. This way a degree of parallelism can be achieved.</p>
<h3>Dependency graph</h3>
<p><a href="https://lmazzole.github.io/SmartFactory_Vehicle-Sortic/main_8cpp.html"><img src="./docs/images/main_8cpp__incl-compl.png" height="250" style="border:none;" alt="" class="inline"/>
 </a> </p>
<p><small>Click on the image to open doxygen-documentation.</small></p>
<p><small> </small></p>
<p><small></small></p>
<p><small>Extern libraries:</small></p>
<p><small></p><ul>
<li><a href="https://github.com/LMazzole/SmartFactory_MQTTCommunication">SmartFactory_MQTTCommunication</a></li>
<li><a href="https://github.com/LMazzole/SmartFactory_Vehicle-Basis">SmartFactory_Vehicle-Basis</a></li>
</ul>
<p></small></p>
<p><small></p><div style="page-break-after: always;"></div><p></small></p>
<p><small></p><h3>Collaboration diagram</h3>
<p></small></p>
<p><small></small></p>
<p><small></small></p>
<p><small> <a href="https://lmazzole.github.io/SmartFactory_Vehicle-Sortic/class_vehicle_ctrl.html"><img src="./docs/images/class_vehicle_ctrl__coll__graph-compl.png" height="400" style="border:none;" alt="" class="inline"/>
 </a> </small></p>
<p><small><small>Click on the image to open doxygen-documentation.</small></small></p>
<p><small><small> </small></small></p>
<p><small><small></small></small></p>
<p><small><small></p><h3>Important functions and files</h3>
<p></small></small></p>
<p><small><small></small></small></p>
<p><small><small></p><h4><a class="el" href="_configuration_8h.html" title="File that contains the configuratioindetails of the different modules.">Configuration.h</a></h4>
<p></small></small></p>
<p><small><small></small></small></p>
<p><small><small>In <a href="https://lmazzole.github.io/SmartFactory_Vehicle-Sortic/_configuration_8h.html">Configuration.h</a> are all important settings for the vehicle defined:</small></small></p>
<p><small><small></p><ul>
<li>Time between the MQTT Publishs (TIME_BETWEEN_PUBLISH)</li>
<li>How long the SmartVehicle for Box-acknowledgement waits (TIMEOUT_VACKS)</li>
<li>How many lines there are (SORTIC_MAX_LINE)</li>
<li>The Hostname-number (DEFAUL_HOSTNAME_NUMBER)</li>
<li>The Hostname "SV"+ Hostname-number (DEFAULT_HOSTNAME)</li>
</ul>
<p></small></small></p>
<p><small><small></p><div style="page-break-after: always;"></div><p></small></small></p>
<p><small><small></p><h3>Communication</h3>
<p></small></small></p>
<p><small><small></small></small></p>
<p><small><small>The <em>SmartVehicle</em> communicates via the <a href="https://github.com/LMazzole/SmartFactory_MQTTCommunication">SmartFactory_MQTTCommunication</a> to an MQTT-Broker, who distributes the messages. The communication works by subscribing to various topics. The subscribed topics change depending on action and position of the Vehicle. The topic-tree looks like this:</small></small></p>
<p><small><small></small></small></p>
<p><small><small><img src="./docs/images/MQTTTopics.png" height="600" alt="" class="inline"/>
</small></small></p>
<p><small><small></small></small></p>
<p><small><small>The Vehicle is constantly subscribed to the topics: <em>error, Vehicle/error, Vehicle/vehicle.id/error</em> and also always publishes its status to <em>Vehicle/vehicle.id/status</em>.</small></small></p>
<p><small><small>More information about the communication process and the complete procedure is documented in <a href="https://github.com/LMazzole/SmartFactory-Sortic#smartfactory-sortic">SmartFactroy-Sortic-ReadMe</a>.</small></small></p>
<p><small><small></p><div style="page-break-after: always;"></div><p></small></small></p>
<p><small><small></p><h4>Handshake with box</h4>
<p></small></small></p>
<p><small><small></small></small></p>
<p><small><small>For a handshake with a box the topic <em>Vehicle/vehicle.id/handshake</em> is used. The confirmation of the new position is sent from the vehicle to the <em>Box/box.id/position</em>.</small></small></p>
<p><small><small></small></small></p>
<p><small><small><object type="image/svg+xml" data="./docs/images/Handshake-detailed.svg" height="650"></object>
/>
</small></small></p>
<p><small><small></small></small></p>
<p><small><small></p><div style="page-break-after: always;"></div><p></small></small></p>
<p><small><small></p><h4>Transfer and vehicle</h4>
<p></small></small></p>
<p><small><small></small></small></p>
<p><small><small>Before the vehicle can bring the box to its new destination, it has to find out where its load is needed and whether that space is available. For this it subscribes to the topic <em>Transfer/Handover</em> and evaluates the received messages.</small></small></p>
<p><small><small></small></small></p>
<p><small><small><object type="image/svg+xml" data="./docs/images/TransferToSV-detailed.svg" height="550"></object>
/>
</small></small></p>
<p><small><small></small></small></p>
<p><small><small></p><div style="page-break-after: always;"></div><p></small></small></p>
<p><small><small></p><h1>FAQ's</h1>
<p></small></small></p>
<p><small><small></small></small></p>
<p><small><small></p><h4>I'd like to use this code in my project. What do I need to know?</h4>
<p></small></small></p>
<p><small><small></small></small></p>
<p><small><small></p><blockquote class="doxtable">
<p>This repository is designed specifically for Sortic. You can still use it, if you stick to the following rules:</p>
<ul>
<li>Use the same handshake and communication sequence for your carrier as documented in <a href="https://github.com/LMazzole/SmartFactory-Sortic">SmartFactory-Sortic</a> and <a href="#communication">Communication</a>. </li>
</ul>
</blockquote>
<p></small></small></p>
<p><small><small></p><h1>ToDo's</h1>
<p></small></small></p>
<p><small><small> </p><h2>Software</h2>
<p></small></small></p>
<p><small><small></p><ul>
<li>[ ] Write a separate test-class</li>
</ul>
<p></small></small></p>
<p><small><small>All open ToDo's can be found in the documentation on the <a href="https://lmazzole.github.io/SmartFactory_Box-Sortic/todo.html">GitHub-Page</a></small></small></p>
<p><small><small></p><h1>Contributors</h1>
<p></small></small></p>
<p><small><small></small></small></p>
<p><small><small></p><ul>
<li><a href="https://github.com/LMazzole">Luca Mazzoleni</a></li>
</ul>
<p></small></small></p>
<p><small><small></p><h1>Changelog</h1>
<p></small></small></p>
<p><small><small></small></small></p>
<p><small><small>V 1.0 - Release BA FS19 - <a href="https://github.com/LMazzole">Luca Mazzoleni</a></small></small></p>
<p><small><small></p><h1>License</h1>
<p></small></small></p>
<p><small><small></small></small></p>
<p><small><small>MIT License </small></small></p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.15 </li>
  </ul>
</div>
</body>
</html>
